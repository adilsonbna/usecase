{{- /*
Generated from 'nodes' from https://raw.githubusercontent.com/prometheus-operator/kube-prometheus/defa2bd1e242519c62a5c2b3b786b1caa6d906d4/manifests/grafana-dashboardDefinitions.yaml
Do not change in-place! In order to change this file first read following link:
https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack/hack
*/ -}}
{{- $kubeTargetVersion := default .Capabilities.KubeVersion.GitVersion .Values.kubeTargetVersionOverride }}
{{- if and (or .Values.grafana.enabled .Values.grafana.forceDeployDashboards) (semverCompare ">=1.14.0-0" $kubeTargetVersion) (semverCompare "<9.9.9-9" $kubeTargetVersion) .Values.grafana.defaultDashboardsEnabled (and (or .Values.nodeExporter.enabled .Values.nodeExporter.forceDeployDashboards) .Values.nodeExporter.operatingSystems.linux.enabled) }}
apiVersion: v1
kind: ConfigMap
metadata:
  namespace: {{ template "kube-prometheus-stack-grafana.namespace" . }}
  name: {{ printf "%s-%s" (include "kube-prometheus-stack.fullname" $) "possystem" | trunc 63 | trimSuffix "-" }}
  annotations:
{{ toYaml .Values.grafana.sidecar.dashboards.annotations | indent 4 }}
  labels:
    {{- if $.Values.grafana.sidecar.dashboards.label }}
    {{ $.Values.grafana.sidecar.dashboards.label }}: {{ ternary $.Values.grafana.sidecar.dashboards.labelValue "1" (not (empty $.Values.grafana.sidecar.dashboards.labelValue)) | quote }}
    {{- end }}
    app: {{ template "kube-prometheus-stack.name" $ }}-grafana
{{ include "kube-prometheus-stack.labels" $ | indent 4 }}
data:
  possystem.json: |-
    {{`{"annotations":{"list":[{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":31,"links":[],"panels":[{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":0,"displayName":"Total of Transations","fieldMinMax":false,"mappings":[],"max":100000,"min":25000,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"blue","value":60000},{"color":"#EAB839","value":90000},{"color":"red","value":100000}]},"unit":"none"},"overrides":[]},"gridPos":{"h":7,"w":5,"x":0,"y":0},"id":1,"options":{"minVizHeight":75,"minVizWidth":75,"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true,"sizing":"auto"},"pluginVersion":"11.3.1","targets":[{"adhocFilters":[],"datasource":{"type":"prometheus","uid":"prometheus"},"editorMode":"code","expr":"max(total_requests{app=\"dev-ern-pos-system\"} )","interval":"","legendFormat":"${metric} (average)","range":true,"refId":"A"}],"title":"[Pos System] - Total page requests","type":"gauge"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"none"},"overrides":[]},"gridPos":{"h":5,"w":4,"x":5,"y":0},"id":10,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","limit":1,"values":true},"showPercentChange":false,"text":{},"textMode":"auto","wideLayout":true},"pluginVersion":"11.3.1","targets":[{"adhocFilters":[],"datasource":{"type":"prometheus","uid":"prometheus"},"editorMode":"code","expr":"sum(items_sold{} )","instant":true,"interval":"","legendFormat":"${metric} (average)","range":true,"refId":"A"}],"title":"[Pos System] - Items Sold Total","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","fillOpacity":80,"gradientMode":"hue","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineWidth":2,"scaleDistribution":{"log":2,"type":"log"},"thresholdsStyle":{"mode":"off"}},"fieldMinMax":false,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"currencyUSD"},"overrides":[]},"gridPos":{"h":12,"w":15,"x":9,"y":0},"id":9,"options":{"barRadius":0,"barWidth":0.97,"fullHighlight":false,"groupWidth":0.7,"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":false},"orientation":"auto","showValue":"auto","stacking":"normal","tooltip":{"mode":"single","sort":"none"},"xTickLabelRotation":0,"xTickLabelSpacing":200},"pluginVersion":"11.3.1","targets":[{"adhocFilters":[],"datasource":{"type":"prometheus","uid":"prometheus"},"editorMode":"code","exemplar":false,"expr":"avg(total_sales_value{} )","instant":true,"interval":"","legendFormat":"__auto","range":true,"refId":"A"}],"title":"[Pos System] - Total Sales USD 15 min","type":"barchart"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"fieldMinMax":false,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"currencyUSD"},"overrides":[]},"gridPos":{"h":7,"w":4,"x":5,"y":5},"id":8,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","limit":1,"values":true},"showPercentChange":true,"text":{},"textMode":"auto","wideLayout":true},"pluginVersion":"11.3.1","targets":[{"adhocFilters":[],"datasource":{"type":"prometheus","uid":"prometheus"},"editorMode":"code","exemplar":false,"expr":"avg(total_sales_value{} )","instant":true,"interval":"","legendFormat":"__auto","range":true,"refId":"A"}],"title":"[Pos System] - Total Sales USD","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"hideFrom":{"legend":false,"tooltip":false,"viz":false}},"fieldMinMax":false,"mappings":[]},"overrides":[]},"gridPos":{"h":9,"w":5,"x":0,"y":7},"id":3,"options":{"displayLabels":["name"],"legend":{"displayMode":"table","placement":"bottom","showLegend":true,"values":["value"]},"pieType":"donut","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"11.3.1","targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"disableTextWrap":false,"editorMode":"builder","expr":"count by(status_code) (http_request_duration_seconds_bucket{app=\"dev-ern-pos-system\"})","fullMetaSearch":false,"includeNullMetadata":true,"instant":true,"legendFormat":"__auto","range":true,"refId":"A","useBackend":false}],"title":"New Panel","type":"piechart"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","fillOpacity":80,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineWidth":1,"scaleDistribution":{"type":"linear"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[]},"gridPos":{"h":9,"w":7,"x":5,"y":12},"id":7,"options":{"barRadius":0,"barWidth":0.88,"fullHighlight":false,"groupWidth":1,"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":false},"orientation":"auto","showValue":"always","stacking":"normal","tooltip":{"mode":"single","sort":"none"},"xTickLabelRotation":0,"xTickLabelSpacing":200},"pluginVersion":"11.3.1","targets":[{"adhocFilters":[],"datasource":{"type":"prometheus","uid":"prometheus"},"editorMode":"code","expr":"sum(items_sold{} )","instant":true,"interval":"","legendFormat":"${metric} (average)","range":true,"refId":"A"}],"title":"[Pos System] - Items Sold","type":"barchart"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"barWidthFactor":0.5,"drawStyle":"line","fillOpacity":42,"gradientMode":"opacity","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineStyle":{"dash":[0,10],"fill":"dot"},"lineWidth":1,"pointSize":7,"scaleDistribution":{"type":"linear"},"showPoints":"always","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"dashed+area"}},"fieldMinMax":false,"mappings":[],"thresholds":{"mode":"percentage","steps":[{"color":"green","value":null},{"color":"#EAB839","value":50},{"color":"#6ED0E0","value":90}]},"unit":"deckbytes"},"overrides":[]},"gridPos":{"h":9,"w":12,"x":12,"y":12},"id":6,"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"11.3.1","targets":[{"adhocFilters":[],"datasource":{"type":"prometheus","uid":"prometheus"},"editorMode":"code","expr":"avg(process_heap_bytes{} )/1024","instant":true,"interval":"","legendFormat":"${metric} (average)","range":true,"refId":"A"}],"title":"[Pos System] - Nodejs HeadDump - MB","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","axisSoftMax":100,"axisSoftMin":100,"fillOpacity":80,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineWidth":1,"scaleDistribution":{"type":"linear"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]}},"overrides":[]},"gridPos":{"h":9,"w":5,"x":0,"y":16},"id":5,"options":{"barRadius":0,"barWidth":0.97,"fullHighlight":false,"groupWidth":0.7,"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":false},"orientation":"auto","showValue":"auto","stacking":"normal","text":{},"tooltip":{"mode":"single","sort":"none"},"xTickLabelRotation":0,"xTickLabelSpacing":100},"pluginVersion":"11.3.1","targets":[{"adhocFilters":[],"datasource":{"type":"prometheus","uid":"prometheus"},"editorMode":"code","expr":"count(nodejs_active_resources{} )","instant":true,"interval":"","legendFormat":"__auto","range":true,"refId":"A"}],"title":"[Pos System] - Active Node Resources","type":"barchart"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","fillOpacity":80,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineWidth":1,"scaleDistribution":{"type":"linear"},"thresholdsStyle":{"mode":"off"}},"fieldMinMax":false,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]}},"overrides":[]},"gridPos":{"h":11,"w":7,"x":5,"y":21},"id":2,"options":{"barRadius":0,"barWidth":0.97,"fullHighlight":false,"groupWidth":0.7,"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"orientation":"auto","showValue":"auto","stacking":"none","tooltip":{"mode":"single","sort":"none"},"xTickLabelRotation":0,"xTickLabelSpacing":0},"pluginVersion":"11.3.1","targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"disableTextWrap":false,"editorMode":"builder","exemplar":false,"expr":"active_users{app=\"dev-ern-pos-system\"}","format":"time_series","fullMetaSearch":false,"includeNullMetadata":true,"instant":false,"legendFormat":"{{job}}","range":true,"refId":"A","useBackend":false}],"title":"[Pos System] - Active Users","type":"barchart"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","fillOpacity":80,"gradientMode":"opacity","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineWidth":1,"scaleDistribution":{"type":"linear"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"mbytes"},"overrides":[]},"gridPos":{"h":11,"w":12,"x":12,"y":21},"id":4,"options":{"barRadius":0,"barWidth":0.97,"fullHighlight":false,"groupWidth":0.7,"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"orientation":"auto","showValue":"always","stacking":"normal","tooltip":{"mode":"single","sort":"none"},"xTickLabelRotation":0,"xTickLabelSpacing":100},"pluginVersion":"11.3.1","targets":[{"adhocFilters":[],"datasource":{"type":"prometheus","uid":"prometheus"},"editorMode":"code","exemplar":false,"expr":"avg(process_resident_memory_bytes{})/1024/1024","format":"table","instant":true,"interval":"","legendFormat":"{{app}}","range":true,"refId":"A"}],"title":"[Pos System] - Process Memory MB","type":"barchart"}],"preload":false,"refresh":"5s","schemaVersion":40,"tags":[],"templating":{"list":[]},"time":{"from":"now-5m","to":"now"},"timepicker":{},"timezone":"browser","title":"POS System Dashborad Use Case","uid":"eeagybktbme4gd","version":18,"weekStart":""}`}}
{{- end }}